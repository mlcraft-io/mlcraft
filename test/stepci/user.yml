tests:
  user:
    steps:
      - name: delete_user
        http:
          url: ${{env.HASURA_GRAPHQL_URL}}
          method: POST
          headers:
            Content-Type: application/json
            x-hasura-admin-secret: ${{env.HASURA_GRAPHQL_ADMIN_SECRET}}
          graphql:
            query: |
              mutation delete_user($id : uuid!){
                delete_users_by_pk(id: $id) {
                  id
                }
              }
            variables:
              id: ${{env.USER_ID}}
          check:
            status: 200
      - name: create_user
        http:
          url: ${{env.HASURA_GRAPHQL_URL}}
          method: POST
          headers:
            Content-Type: application/json
            x-hasura-admin-secret: ${{env.HASURA_GRAPHQL_ADMIN_SECRET}}
          graphql:
            query: |
              mutation insert_user($id : uuid!){
                insert_users_one(object: {display_name: "Test User", id: $id}) {
                  id
                }
              }
            variables:
              id: ${{env.USER_ID}}
          check:
            status: 200
            jsonpath:
              $.data.insert_users_one.id: ${{env.USER_ID}}